// ==UserScript==
// @name         SOOP ë°´í—ˆë¸Œ ì •ë³´ ì¶œë ¥
// @namespace    https://www.sooplive.co.kr/
// @version      1.2
// @description  ìœ ì € íŒì—…ì— ë°´í—ˆë¸Œ ì œì¬ ì •ë³´ í‘œì‹œ ë° ë°”ë¡œê°€ê¸° ë²„íŠ¼ ì¶”ê°€
// @match        https://play.sooplive.co.kr/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=play.sooplive.co.kr
// @grant        none
// @updateURL    https://raw.githubusercontent.com/life1spotato/autopsy/refs/heads/main/autopsy.js
// @downloadURL  https://raw.githubusercontent.com/life1spotato/autopsy/refs/heads/main/autopsy.js
// @license MIT
// ==/UserScript==

!function(){"use strict";const t="https://autopsy.life1spotato.workers.dev/?url=",n="https://banhub.xyz/soop/user/",e={normal:"#e0e0e0",warning:"#ffa502",danger:"#ff4757",loading:"#b0b0b0",noData:"#a4b0be",timePeriod:"#a5b1c2",timeout:"#ff7f50"};async function o(o,a,s,r){const c=new AbortController,i=Date.now()+s,l=()=>{const t=Math.max(0,Math.ceil((i-Date.now())/1e3)),n=a.querySelector(".countdown");n&&(n.textContent=t,n.style.color=t<=3?e.timeout:e.loading)},u=r?"ì¬ì‹œë„":"ì¡°íšŒ";a.innerHTML=`â³ ${u} ì¤‘... (<span class="countdown" style="color:${e.loading}">${Math.ceil(s/1e3)}</span>ì´ˆ)`;const d=setInterval(l,250);l();const p=setTimeout((()=>{clearInterval(d),c.abort()}),s);try{const e=await async function(e,o){const a=`${n}${e}`,s=`${t}${encodeURIComponent(a)}`,r=await fetch(s,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36"},signal:o});if(!r.ok)throw new Error(404===r.status?"User not found":`Fetch failed with status ${r.status}`);const c=await r.text();if(!c.includes("banhub"))throw new Error("Invalid response from server");const i=function(t){const n=t.match(/<span class="text-2xl font-bold">(\d+)<\/span>.*ê°•ì œ í‡´ì¥/s),e=t.match(/<span class="text-2xl font-bold">(\d+)<\/span>.*ì±„íŒ… ê¸ˆì§€/s);return{forcedExit:n?n[1]:"0",chatBan:e?e[1]:"0"}}(c),l=function(t){const n=new Date;n.setDate(n.getDate()-7),n.setHours(0,0,0,0);const e=t.match(/<div class="[^"]*bg-neutral-950[^"]*"[^>]*>.*?<\/div>/gs)||[],o=[];for(const t of e){const e=t.match(/<span class="text-neutral-400[^>]*>(\d{2}\.\d{2}\.\d{2})<\/span>/);if(!e)continue;const[a,s]=e,[r,c,i]=s.split("."),l=new Date(`20${r}-${c}-${i}`);if(l.setHours(0,0,0,0),l>=n){const n=t.match(/<span class="whitespace-nowrap"[^>]*>([^<]+)<\/span>/),e=t.match(/<span class="font-medium"[^>]*>([^<]+)<\/span>/);o.push({date:l,banType:n?n[1].trim():"ì•Œ ìˆ˜ ì—†ìŒ",streamer:e?e[1].trim():"ì•Œ ìˆ˜ ì—†ìŒ"})}}return o.sort(((t,n)=>n.date-t.date))}(c);return{last24Hours:i,recentBans:l}}(o,c.signal);return clearTimeout(p),clearInterval(d),e}catch(t){throw clearTimeout(p),clearInterval(d),t}}function a(t,{last24Hours:n={},recentBans:o=[]},a){const s=parseInt(n.forcedExit||"0")>0||parseInt(n.chatBan||"0")>0,r=o.length>0;let c="",i="";if(s){const t=parseInt(n.forcedExit||"0"),o=parseInt(n.chatBan||"0");c+=`<span style="color:${e.timePeriod}">ğŸš¨ 24ì‹œê°„</span>: `,o>0&&(c+=`<span style="color:${e.warning}">ì±„ê¸ˆ ${o}íšŒ</span>`),o>0&&t>0&&(c+=" | "),t>0&&(c+=`<span style="color:${e.danger}">ê°•í‡´ ${t}íšŒ</span>`),i+=`ìµœê·¼ 24ì‹œê°„\n- ì±„ê¸ˆ: ${o}íšŒ\n- ê°•í‡´: ${t}íšŒ\n`}if(r){s&&(c+="\n");const t=new Date,n=o.reduce(((t,n)=>(n.banType.includes("ê°•í‡´")?t.forcedExit++:n.banType.includes("ì±„ê¸ˆ")&&t.chatBan++,t)),{forcedExit:0,chatBan:0});c+=`<span style="color:${e.timePeriod}">ğŸ“‰ 7ì¼</span>: `,n.chatBan>0&&(c+=`<span style="color:${e.warning}">ì±„ê¸ˆ ${n.chatBan}íšŒ</span>`),n.chatBan>0&&n.forcedExit>0&&(c+=" | "),n.forcedExit>0&&(c+=`<span style="color:${e.danger}">ê°•í‡´ ${n.forcedExit}íšŒ</span>`),i+="\nìµœê·¼ 7ì¼ ì œì¬ ì´ë ¥:\n",i+=o.map((n=>{const e=t-n.date;return`[${Math.floor(e/864e5)}ì¼ì „] ${n.streamer} - ${n.banType}`})).join("\n")}s||r||(c="âœ… ì œì¬ ì´ë ¥ ì—†ìŒ"),t.innerHTML=c,t.title=i,t.style.textAlign="left",t.style.whiteSpace="pre",t.style.lineHeight="1.4"}new MutationObserver((t=>{t.forEach((t=>{t.addedNodes.forEach((t=>{1===t.nodeType&&t.classList?.contains("chatIct-card")&&async function(t){const s=function(t){const n=t.getAttribute("user_id");return n?n.replace(/\(\d+\)/g,""):null}(t);if(!s)return;const r=t.querySelector(".menu-list");if(!r)return;!function(t){const n=t.querySelector("#banInfoButton");n&&n.parentElement.remove()}(t);const{button:c,listItem:i}=function(t,n){const o=document.createElement("button");o.id="banInfoButton",o.type="button",o.style.cssText=`\n            white-space: pre;\n            text-align: left;\n            padding: 6px 12px;\n            width: 100%;\n            font-size: 12px;\n            cursor: pointer;\n            color: ${e.loading};\n            border: none;\n            background: none;\n            line-height: 1.4;\n            min-height: 36px;\n            display: block;\n        `,o.textContent="ğŸ” ê²€ìƒ‰ ì¤‘...";const a=document.createElement("li");return a.appendChild(o),t.insertBefore(a,t.firstChild),{button:o,listItem:a}}(r);!function(t,e){t.addEventListener("click",(t=>{t.stopPropagation(),window.open(`${n}${e}`,"_blank")}))}(c,s);try{a(c,await o(s,c,1e4,!1),s)}catch(t){console.log("ì²« ì‹œë„ ì‹¤íŒ¨, ì¬ì‹œë„ ì§„í–‰:",t);try{c.innerHTML='ğŸ”„ ì¬ì‹œë„ ì¤‘... (<span style="color:'+e.timeout+'">10</span>ì´ˆ)';a(c,await o(s,c,1e4,!0),s)}catch(t){console.log("ì¬ì‹œë„ ì‹¤íŒ¨:",t),function(t,n){"User not found"===n.message?(t.style.color=e.noData,t.textContent="âœ… ë°ì´í„° ì—†ìŒ",t.title="í•´ë‹¹ ì‚¬ìš©ìì˜ ì œì¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤ (í´ë¦­ì‹œ ë°´í—ˆë¸Œ í˜ì´ì§€ë¡œ ì´ë™)"):"AbortError"===n.name?(t.style.color=e.timeout,t.textContent="âŒ› ì‹œê°„ ì´ˆê³¼",t.title="ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš” (í´ë¦­ì‹œ ë°´í—ˆë¸Œ í˜ì´ì§€ë¡œ ì´ë™)"):(t.style.color=e.warning,t.textContent="âš ï¸ ì¡°íšŒ ì‹¤íŒ¨",t.title=`ë°´í—ˆë¸Œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤: ${n.message} (í´ë¦­ì‹œ ë°´í—ˆë¸Œ í˜ì´ì§€ë¡œ ì´ë™)`)}(c,t)}}}(t)}))}))})).observe(document.body,{childList:!0,subtree:!0})}();
