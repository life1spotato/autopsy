// ==UserScript==
// @name         SOOP 밴허브에서 보기
// @namespace    https://www.sooplive.co.kr/
// @version      1.1
// @description  SOOP 채팅창에서 아이디를 누르면 밴허브 검색 메뉴를 추가합니다.
// @match        https://play.sooplive.co.kr/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=play.sooplive.co.kr
// @grant        none
// @updateURL    https://raw.githubusercontent.com/life1spotato/autopsy/refs/heads/main/autopsy.js
// @downloadURL  https://raw.githubusercontent.com/life1spotato/autopsy/refs/heads/main/autopsy.js
// @license MIT
// ==/UserScript==

!function(){"use strict";const t="https://cors-anywhere.herokuapp.com/",e="https://banhub.xyz/soop/user/",n={normal:"#e0e0e0",warning:"#ffa502",danger:"#ff4757",loading:"#b0b0b0",link:"#4dabf7",noData:"#a4b0be"};function r(t){const e=t.querySelectorAll(".text-2xl.font-bold");return{forcedExit:e[1]?.textContent.trim()||"0",chatBan:e[2]?.textContent.trim()||"0"}}function o(t){const e=new Date;return e.setDate(e.getDate()-7),e.setHours(0,0,0,0),Array.from(t.querySelectorAll(".bg-neutral-950, .dark\\:bg-neutral-900")).map((t=>{const n=t.querySelector(".text-neutral-400:not(.inline-block)");if(!n)return null;const r=n.textContent.trim();if(!/^\d{2}\.\d{2}\.\d{2}$/.test(r))return null;const[o,a,s]=r.split("."),c=new Date(`20${o}-${a}-${s}`);return c.setHours(0,0,0,0),c>=e?{date:r,banType:t.querySelector(".whitespace-nowrap")?.textContent.trim()||"알 수 없음",streamer:t.querySelector(".font-medium")?.textContent.trim()||"알 수 없음"}:null})).filter(Boolean)}new MutationObserver((a=>{a.forEach((a=>{a.addedNodes.forEach((a=>{1===a.nodeType&&a.classList?.contains("chatIct-card")&&async function(a){const s=function(t){const e=t.getAttribute("user_id");return e?e.replace(/\(\d+\)/g,""):null}(a);if(!s)return;const c=a.querySelector(".menu-list");if(!c)return;!function(t){const e=t.querySelector("#banInfoButton");e&&e.parentElement.remove()}(a);const{button:i,listItem:l}=function(t,e){const r=document.createElement("button");r.id="banInfoButton",r.type="button",r.style.cssText=`\n            white-space: nowrap;\n            text-align: left;\n            padding: 8px 12px;\n            width: 100%;\n            font-size: 12px;\n            cursor: pointer;\n            color: ${n.loading};\n            border: none;\n            background: none;\n        `,r.textContent="🔍 밴허브 검색 중...";const o=document.createElement("li");return o.appendChild(r),t.insertBefore(o,t.firstChild),{button:r,listItem:o}}(c);try{const a=await async function(n){const a=await fetch(`${t}${e}${n}`,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36","X-Requested-With":"XMLHttpRequest"}});if(!a.ok)throw new Error(404===a.status?"User not found":"Fetch failed");const s=await a.text(),c=(new DOMParser).parseFromString(s,"text/html");return{last24Hours:r(c),recentBans:o(c)}}(s);!function(t,{last24Hours:r,recentBans:o},a){const s=o.length>0,c=parseInt(r.forcedExit)>0||parseInt(r.chatBan)>0,i=c?n.danger:s?n.warning:n.normal;let l="🚨 ";(parseInt(r.forcedExit)>0||parseInt(r.chatBan)>0)&&(l+=`24h: 강퇴${r.forcedExit} 채금${r.chatBan} `);o.length>0&&(l+=`7d: 제재${o.length}회`);c||s||(l="✅ 제재 이력 없음");if(t.style.color=i,t.textContent=l,c||s){let e="";parseInt(r.forcedExit)>0&&(e+=`최근 24시간 강퇴: ${r.forcedExit}회\n`),parseInt(r.chatBan)>0&&(e+=`최근 24시간 채금: ${r.chatBan}회\n`),o.length>0&&(e+="최근 7일 제재 이력:\n",e+=o.map((t=>`[${t.date}] ${t.streamer} - ${t.banType}`)).join("\n")),t.title=e}t.addEventListener("click",(t=>{t.stopPropagation(),window.open(`${e}${a}`,"_blank")}),{once:!0})}(i,a,s)}catch(t){!function(t,e){"User not found"===e.message?(t.style.color=n.noData,t.textContent="🔍 밴허브 데이터 없음",t.title="해당 사용자의 제재 정보가 없습니다"):(t.style.color=n.warning,t.textContent="⚠️ 조회 실패",t.title="밴허브 정보를 불러오지 못했습니다")}(i,t),console.error("Error:",t)}}(a)}))}))})).observe(document.body,{childList:!0,subtree:!0})}();
