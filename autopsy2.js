// ==UserScript==
// @name         SOOP ë°´í—ˆë¸Œ ì •ë³´ ì¶œë ¥
// @namespace    https://www.sooplive.co.kr/
// @version      1.1
// @description  ìœ ì € íŒì—…ì— ë°´í—ˆë¸Œ ì œì¬ ì •ë³´ í‘œì‹œ ë° ë°”ë¡œê°€ê¸° ë²„íŠ¼ ì¶”ê°€
// @match        https://play.sooplive.co.kr/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=play.sooplive.co.kr
// @grant        none
// @updateURL    https://raw.githubusercontent.com/life1spotato/autopsy/refs/heads/main/autopsy2.js
// @downloadURL  https://raw.githubusercontent.com/life1spotato/autopsy/refs/heads/main/autopsy2.js
// @license MIT
// ==/UserScript==

!function(){"use strict";const t="https://autopsy.life1spotato.workers.dev/?url=",e="https://banhub.xyz/soop/user/",n={normal:"#e0e0e0",warning:"#ffa502",danger:"#ff4757",loading:"#b0b0b0",link:"#4dabf7",noData:"#a4b0be",timePeriod:"#a5b1c2"};function o(t){const e=t.querySelectorAll(".text-2xl.font-bold");return{forcedExit:e[1]?.textContent.trim()||"0",chatBan:e[2]?.textContent.trim()||"0"}}function r(t){const e=new Date;return e.setDate(e.getDate()-7),e.setHours(0,0,0,0),Array.from(t.querySelectorAll(".bg-neutral-950, .dark\\:bg-neutral-900")).map((t=>{const n=t.querySelector(".text-neutral-400:not(.inline-block)");if(!n)return null;const o=n.textContent.trim();if(!/^\d{2}\.\d{2}\.\d{2}$/.test(o))return null;const[r,a,s]=o.split("."),i=new Date(`20${r}-${a}-${s}`);return i.setHours(0,0,0,0),i>=e?{date:i,banType:t.querySelector(".whitespace-nowrap")?.textContent.trim()||"ì•Œ ìˆ˜ ì—†ìŒ",streamer:t.querySelector(".font-medium")?.textContent.trim()||"ì•Œ ìˆ˜ ì—†ìŒ"}:null})).filter(Boolean).sort(((t,e)=>e.date-t.date))}new MutationObserver((a=>{a.forEach((a=>{a.addedNodes.forEach((a=>{1===a.nodeType&&a.classList?.contains("chatIct-card")&&async function(a){const s=function(t){const e=t.getAttribute("user_id");return e?e.replace(/\(\d+\)/g,""):null}(a);if(!s)return;const i=a.querySelector(".menu-list");if(!i)return;!function(t){const e=t.querySelector("#banInfoButton");e&&e.parentElement.remove()}(a);const{button:c,listItem:l}=function(t,e){const o=document.createElement("button");o.id="banInfoButton",o.type="button",o.style.cssText=`\n            white-space: pre;\n            text-align: left;\n            padding: 6px 12px;\n            width: 100%;\n            font-size: 12px;\n            cursor: pointer;\n            color: ${n.loading};\n            border: none;\n            background: none;\n            line-height: 1.4;\n            min-height: 36px;\n            display: block;\n        `,o.textContent="ğŸ” ê²€ìƒ‰ ì¤‘...";const r=document.createElement("li");return r.appendChild(o),t.insertBefore(r,t.firstChild),{button:o,listItem:r}}(i);!function(t,n){t.addEventListener("click",(t=>{t.stopPropagation(),window.open(`${e}${n}`,"_blank")}))}(c,s);try{const a=await async function(n){try{const a=`${e}${n}`,s=`${t}${encodeURIComponent(a)}`,i=await fetch(s,{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36"}});if(!i.ok)throw new Error(404===i.status?"User not found":`Fetch failed with status ${i.status}`);const c=await i.text();if(!c.includes("banhub"))throw new Error("Invalid response from server");const l=(new DOMParser).parseFromString(c,"text/html");return{last24Hours:o(l),recentBans:r(l)}}catch(t){throw console.error("Failed to fetch ban info:",t),t}}(s);!function(t,{last24Hours:e={},recentBans:o=[]},r){const a=parseInt(e.forcedExit||"0")>0||parseInt(e.chatBan||"0")>0,s=o.length>0;let i="",c="";if(a){const t=parseInt(e.forcedExit||"0"),o=parseInt(e.chatBan||"0");i+=`<span style="color:${n.timePeriod}">ğŸš¨ 24ì‹œê°„</span>: `,o>0&&(i+=`<span style="color:${n.warning}">ì±„ê¸ˆ ${o}íšŒ</span>`),o>0&&t>0&&(i+=" | "),t>0&&(i+=`<span style="color:${n.danger}">ê°•í‡´ ${t}íšŒ</span>`),c+=`ìµœê·¼ 24ì‹œê°„\n- ì±„ê¸ˆ: ${o}íšŒ\n- ê°•í‡´: ${t}íšŒ\n`}if(s){a&&(i+="\n");const t=new Date,e=o.reduce(((t,e)=>(e.banType.includes("ê°•í‡´")?t.forcedExit++:e.banType.includes("ì±„ê¸ˆ")&&t.chatBan++,t)),{forcedExit:0,chatBan:0});i+=`<span style="color:${n.timePeriod}">ğŸ“‰ 7ì¼</span>: `,e.chatBan>0&&(i+=`<span style="color:${n.warning}">ì±„ê¸ˆ ${e.chatBan}íšŒ</span>`),e.chatBan>0&&e.forcedExit>0&&(i+=" | "),e.forcedExit>0&&(i+=`<span style="color:${n.danger}">ê°•í‡´ ${e.forcedExit}íšŒ</span>`),c+="\nìµœê·¼ 7ì¼ ì œì¬ ì´ë ¥:\n",c+=o.map((e=>{const n=t-e.date;return`[${Math.floor(n/864e5)}ì¼ì „] ${e.streamer} - ${e.banType}`})).join("\n")}a||s||(i="âœ… ì œì¬ ì´ë ¥ ì—†ìŒ");t.innerHTML=i,t.title=c,t.style.textAlign="left",t.style.whiteSpace="pre",t.style.lineHeight="1.4"}(c,a)}catch(t){!function(t,e){"User not found"===e.message?(t.style.color=n.noData,t.textContent="âœ… ë°ì´í„° ì—†ìŒ",t.title="í•´ë‹¹ ì‚¬ìš©ìì˜ ì œì¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤ (í´ë¦­ì‹œ ë°´í—ˆë¸Œ í˜ì´ì§€ë¡œ ì´ë™)"):(t.style.color=n.warning,t.textContent="âš ï¸ ì¡°íšŒ ì‹¤íŒ¨",t.title="ë°´í—ˆë¸Œ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤ (í´ë¦­ì‹œ ë°´í—ˆë¸Œ í˜ì´ì§€ë¡œ ì´ë™)")}(c,t),console.error("Error:",t)}}(a)}))}))})).observe(document.body,{childList:!0,subtree:!0})}();
